{
  "name": "Голосовой помощник CRM",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "voice-assistant",
        "responseMode": "responseNode"
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        240,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "const requestData = $input.first().json;\nconst message = requestData.message || '';\nconst user_id = requestData.user_id || '';\n\nconst systemPrompt = 'Ты голосовой помощник для CRM системы строительной компании. Отвечай коротко и по делу.';\n\nconst messages = [\n  { role: 'system', content: systemPrompt },\n  { role: 'user', content: message }\n];\n\nreturn { \n  messages: messages,\n  user_id: user_id,\n  original_message: message\n};"
      },
      "id": "prepare-request",
      "name": "Подготовка запроса",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        460,
        300
      ]
    },
    {
      "parameters": {
        "resource": "chat",
        "operation": "create",
        "model": "gpt-4o-mini",
        "messages": "={{ $json.messages }}",
        "temperature": 0.7,
        "maxTokens": 500
      },
      "id": "openai-request",
      "name": "OpenAI Анализ",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1,
      "position": [
        680,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "const openaiResponse = $input.first().json;\nconst response = openaiResponse.choices[0].message.content || 'Ответ от AI';\n\nreturn { response: response };"
      },
      "id": "format-response",
      "name": "Формирование ответа",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        900,
        300
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"response\": \"{{ $json.response }}\",\n  \"success\": true,\n  \"timestamp\": \"{{ new Date().toISOString() }}\"\n}"
      },
      "id": "webhook-response",
      "name": "Ответ Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1120,
        300
      ]
    }
  ],
  "connections": {
    "webhook-trigger": {
      "main": [
        [
          {
            "node": "prepare-request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prepare-request": {
      "main": [
        [
          {
            "node": "openai-request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai-request": {
      "main": [
        [
          {
            "node": "format-response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "format-response": {
      "main": [
        [
          {
            "node": "webhook-response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {},
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2024-01-01T00:00:00.000Z",
  "versionId": "1"
}