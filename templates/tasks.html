
{% extends "layout.html" %}

{% block title %}Задачи - CRM{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-3xl font-bold tracking-tight">Задачи</h1>
            <p class="text-muted-foreground mt-1">
                Управление задачами в формате канбан-доски
            </p>
        </div>
        <a href="{{ url_for('task_edit', task_id=0) }}" class="btn btn-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
            Новая задача
        </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Колонка "К выполнению" -->
        <div class="bg-card rounded-lg shadow-sm border">
            <div class="p-4 border-b">
                <h2 class="text-lg font-semibold">К выполнению ({{ tasks.pending|length }})</h2>
            </div>
            <div class="p-4 space-y-4">
                {% for task in tasks.pending %}
                    {{ render_task_card(task) }}
                {% else %}
                    <p class="text-muted-foreground text-sm italic">Нет задач</p>
                {% endfor %}
            </div>
        </div>

        <!-- Колонка "В работе" -->
        <div class="bg-card rounded-lg shadow-sm border">
            <div class="p-4 border-b">
                <h2 class="text-lg font-semibold">В работе ({{ tasks.in_progress|length }})</h2>
            </div>
            <div class="p-4 space-y-4">
                {% for task in tasks.in_progress %}
                    {{ render_task_card(task) }}
                {% else %}
                    <p class="text-muted-foreground text-sm italic">Нет задач</p>
                {% endfor %}
            </div>
        </div>

        <!-- Колонка "Выполнено" -->
        <div class="bg-card rounded-lg shadow-sm border">
            <div class="p-4 border-b">
                <h2 class="text-lg font-semibold">Выполнено ({{ tasks.completed|length }})</h2>
            </div>
            <div class="p-4 space-y-4">
                {% for task in tasks.completed %}
                    {{ render_task_card(task) }}
                {% else %}
                    <p class="text-muted-foreground text-sm italic">Нет задач</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% macro render_task_card(task) %}
<div class="bg-background border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow duration-200">
    <div class="flex justify-between items-start">
        <h3 class="font-semibold text-base mb-2">{{ task.title }}</h3>
        <a href="{{ url_for('task_edit', task_id=task.id) }}" class="text-muted-foreground hover:text-primary">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
        </a>
    </div>
    <p class="text-sm text-muted-foreground mb-3">{{ task.description or '' }}</p>
    <div class="flex justify-between items-center text-xs">
        <div>
            {% if task.due_date %}
            <span class="text-muted-foreground">Срок: {{ task.due_date|format_date }}</span>
            {% endif %}
        </div>
        <div>
            {% if task.client_name %}
            <a href="{{ url_for('client_detail', client_id=task.client_id) }}" class="font-semibold text-primary hover:underline">{{ task.client_name }}</a>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}
{% endblock %}
