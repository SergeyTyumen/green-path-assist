{% extends "base.html" %}

{% block title %}–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ - ParkConstructionCRM{% endblock %}
{% block page_title %}–ì–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="text-center">
        <h1 class="text-3xl font-bold tracking-tight">üé§ –ì–æ–ª–æ—Å–æ–≤–æ–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫</h1>
        <p class="text-muted-foreground mt-2">
            –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–π—Ç–µ —Å CRM —Å–∏—Å—Ç–µ–º–æ–π —á–µ—Ä–µ–∑ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
        </p>
    </div>
    
    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–º -->
    <div class="card p-8 text-center">
        <div class="space-y-6">
            <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø–∏—Å–∏ -->
            <div>
                <button id="voiceBtn" class="w-20 h-20 rounded-full bg-red-500 hover:bg-red-600 text-white transition-all transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-red-500/50">
                    <i data-lucide="mic" class="h-8 w-8 mx-auto"></i>
                </button>
            </div>
            
            <!-- –°—Ç–∞—Ç—É—Å -->
            <div>
                <p id="voiceStatus" class="text-lg font-medium">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏</p>
                <p class="text-sm text-muted-foreground mt-2">
                    –ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–æ –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
                </p>
            </div>
            
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–æ–≤ -->
            <div class="flex items-center justify-center space-x-4">
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="voiceResponse" class="rounded border-border focus:ring-ring">
                    <span class="text-sm">–ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã</span>
                </label>
                <label class="flex items-center space-x-2">
                    <input type="checkbox" id="autoMode" class="rounded border-border focus:ring-ring">
                    <span class="text-sm">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º</span>
                </label>
            </div>
        </div>
    </div>
    
    <!-- –ß–∞—Ç -->
    <div class="card">
        <div class="p-6 border-b border-border">
            <h3 class="text-lg font-semibold">–ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞</h3>
            <button id="clearChat" class="btn btn-ghost text-sm mt-2">
                <i data-lucide="trash-2" class="mr-2 h-4 w-4"></i>
                –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
            </button>
        </div>
        
        <div class="p-6">
            <div id="chatMessages" class="space-y-4 min-h-[300px] max-h-[500px] overflow-y-auto">
                <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                <div class="flex space-x-3">
                    <div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center">
                        <i data-lucide="bot" class="h-4 w-4 text-primary"></i>
                    </div>
                    <div class="flex-1">
                        <div class="bg-muted rounded-lg p-3">
                            <p class="text-sm">
                                –ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –≥–æ–ª–æ—Å–æ–≤–æ–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º–∏, 
                                –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ CRM —Å–∏—Å—Ç–µ–º–µ. 
                                –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
                            </p>
                        </div>
                        <p class="text-xs text-muted-foreground mt-1">–°–µ–π—á–∞—Å</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ -->
        <div class="p-6 border-t border-border">
            <div class="flex space-x-3">
                <input 
                    type="text" 
                    id="textInput" 
                    placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–º..." 
                    class="flex-1 border border-border rounded-md px-3 py-2 bg-background focus:outline-none focus:ring-2 focus:ring-ring"
                >
                <button id="sendBtn" class="btn btn-primary">
                    <i data-lucide="send" class="h-4 w-4"></i>
                </button>
            </div>
        </div>
    </div>
    
    <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã -->
    <div class="card">
        <div class="p-6">
            <h3 class="text-lg font-semibold mb-4">–ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>
            <div class="grid gap-3 md:grid-cols-2 lg:grid-cols-3">
                <button class="btn btn-secondary text-left p-3 h-auto quick-command" data-command="–ü–æ–∫–∞–∂–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤">
                    <div>
                        <p class="font-medium">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã</p>
                        <p class="text-xs text-muted-foreground">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö</p>
                    </div>
                </button>
                
                <button class="btn btn-secondary text-left p-3 h-auto quick-command" data-command="–ö–∞–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º?">
                    <div>
                        <p class="font-medium">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤</p>
                        <p class="text-xs text-muted-foreground">–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</p>
                    </div>
                </button>
                
                <button class="btn btn-secondary text-left p-3 h-auto quick-command" data-command="–°–æ–∑–¥–∞–π –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞">
                    <div>
                        <p class="font-medium">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</p>
                        <p class="text-xs text-muted-foreground">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞—è–≤–∫—É</p>
                    </div>
                </button>
                
                <button class="btn btn-secondary text-left p-3 h-auto quick-command" data-command="–ö–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è?">
                    <div>
                        <p class="font-medium">–ó–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</p>
                        <p class="text-xs text-muted-foreground">–ü–ª–∞–Ω—ã –Ω–∞ –¥–µ–Ω—å</p>
                    </div>
                </button>
                
                <button class="btn btn-secondary text-left p-3 h-auto quick-command" data-command="–ü–æ–º–æ—â—å –ø–æ —Å–∏—Å—Ç–µ–º–µ">
                    <div>
                        <p class="font-medium">–°–ø—Ä–∞–≤–∫–∞</p>
                        <p class="text-xs text-muted-foreground">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è CRM</p>
                    </div>
                </button>
                
                <button class="btn btn-secondary text-left p-3 h-auto quick-command" data-command="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞">
                    <div>
                        <p class="font-medium">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</p>
                        <p class="text-xs text-muted-foreground">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–º–æ—â–Ω–∏–∫–∞</p>
                    </div>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
    console.log('üé§ Voice Assistant page loaded');
    
    let isRecording = false;
    let mediaRecorder = null;
    let audioStream = null;
    
    const voiceBtn = document.getElementById('voiceBtn');
    const voiceStatus = document.getElementById('voiceStatus');
    const chatMessages = document.getElementById('chatMessages');
    const textInput = document.getElementById('textInput');
    const sendBtn = document.getElementById('sendBtn');
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
        voiceBtn.addEventListener('click', toggleRecording);
        sendBtn.addEventListener('click', sendTextMessage);
        textInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendTextMessage();
        });
        
        // –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã
        document.querySelectorAll('.quick-command').forEach(btn => {
            btn.addEventListener('click', () => {
                const command = btn.dataset.command;
                sendMessage(command, 'user');
                processCommand(command);
            });
        });
        
        // –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞
        document.getElementById('clearChat').addEventListener('click', clearChat);
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
    async function toggleRecording() {
        if (!isRecording) {
            await startRecording();
        } else {
            stopRecording();
        }
    }
    
    // –ù–∞—á–∞–ª–æ –∑–∞–ø–∏—Å–∏
    async function startRecording() {
        try {
            audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(audioStream);
            
            mediaRecorder.ondataavailable = handleAudioData;
            mediaRecorder.onstop = processAudio;
            
            mediaRecorder.start();
            isRecording = true;
            
            voiceBtn.innerHTML = '<i data-lucide="square" class="h-8 w-8 mx-auto"></i>';
            voiceBtn.className = voiceBtn.className.replace('bg-red-500 hover:bg-red-600', 'bg-green-500 hover:bg-green-600');
            voiceStatus.textContent = '–ó–∞–ø–∏—Å—å... –ù–∞–∂–º–∏—Ç–µ –µ—â–µ —Ä–∞–∑ –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏';
            
            lucide.createIcons();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', error);
            voiceStatus.textContent = '–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É';
        }
    }
    
    // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
    function stopRecording() {
        if (mediaRecorder && isRecording) {
            mediaRecorder.stop();
            audioStream.getTracks().forEach(track => track.stop());
            
            isRecording = false;
            voiceBtn.innerHTML = '<i data-lucide="mic" class="h-8 w-8 mx-auto"></i>';
            voiceBtn.className = voiceBtn.className.replace('bg-green-500 hover:bg-green-600', 'bg-red-500 hover:bg-red-600');
            voiceStatus.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ...';
            
            lucide.createIcons();
        }
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö
    function handleAudioData(event) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ
        console.log('Audio data received:', event.data);
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏
    function processAudio() {
        // –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏
        setTimeout(() => {
            const demoText = '–ü–æ–∫–∞–∂–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º';
            sendMessage(demoText, 'user');
            processCommand(demoText);
            voiceStatus.textContent = '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏';
        }, 1000);
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    function sendTextMessage() {
        const text = textInput.value.trim();
        if (text) {
            sendMessage(text, 'user');
            processCommand(text);
            textInput.value = '';
        }
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function sendMessage(text, sender) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'flex space-x-3';
        
        const isUser = sender === 'user';
        const icon = isUser ? 'user' : 'bot';
        const bgColor = isUser ? 'bg-primary text-primary-foreground' : 'bg-muted';
        
        messageDiv.innerHTML = `
            <div class="w-8 h-8 ${isUser ? 'bg-primary' : 'bg-primary/10'} rounded-full flex items-center justify-center">
                <i data-lucide="${icon}" class="h-4 w-4 ${isUser ? 'text-primary-foreground' : 'text-primary'}"></i>
            </div>
            <div class="flex-1">
                <div class="${bgColor} rounded-lg p-3">
                    <p class="text-sm">${text}</p>
                </div>
                <p class="text-xs text-muted-foreground mt-1">–°–µ–π—á–∞—Å</p>
            </div>
        `;
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        lucide.createIcons();
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
    function processCommand(command) {
        setTimeout(() => {
            const lowerCommand = command.toLowerCase();
            let response = '';
            
            if (lowerCommand.includes('–∫–ª–∏–µ–Ω—Ç') || lowerCommand.includes('–ø–æ—Å–ª–µ–¥–Ω')) {
                response = '–£ –≤–∞—Å {{ total_clients or 0 }} –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ. –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ: –ì–∞–≤—Ä–∏–ª—é–∫ –°–µ—Ä–≥–µ–π –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á (—Ñ—É—Ç–±–æ–ª—å–Ω–æ–µ –ø–æ–ª–µ), –ø—Ä–æ–µ–∫—Ç –Ω–∞ 1.5–ú —Ä—É–±–ª–µ–π.';
            } else if (lowerCommand.includes('—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫') || lowerCommand.includes('–ø—Ä–æ–µ–∫—Ç')) {
                response = '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: {{ total_projects or 0 }} –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, 8 —Å–º–µ—Ç –Ω–∞ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏, –æ–±—â–∏–π –¥–æ—Ö–æ–¥ 2.4–ú —Ä—É–±–ª–µ–π (+20% –∫ –ø—Ä–æ—à–ª–æ–º—É –º–µ—Å—è—Ü—É).';
            } else if (lowerCommand.includes('—Å–æ–∑–¥–∞–π') || lowerCommand.includes('–¥–æ–±–∞–≤')) {
                response = '–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–ö–ª–∏–µ–Ω—Ç—ã –∏ –∑–∞—è–≤–∫–∏" –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞". –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è –æ—Ç–∫—Ä—ã–ª —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É?';
            } else if (lowerCommand.includes('–∑–∞–¥–∞—á') || lowerCommand.includes('—Å–µ–≥–æ–¥–Ω—è')) {
                response = '–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è —Å –∫–ª–∏–µ–Ω—Ç–æ–º –ì–∞–≤—Ä–∏–ª—é–∫ –°.–í., –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–º–µ—Ç—É –¥–ª—è –¥–µ—Ç—Å–∫–æ–π –ø–ª–æ—â–∞–¥–∫–∏, –≤—Å—Ç—Ä–µ—á–∞ —Å –ø–æ–¥—Ä—è–¥—á–∏–∫–æ–º –≤ 15:00.';
            } else if (lowerCommand.includes('–ø–æ–º–æ—â—å') || lowerCommand.includes('—Å–ø—Ä–∞–≤–∫')) {
                response = 'ParkConstructionCRM –ø–æ–º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –ø–∞—Ä–∫–æ–≤–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞. –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã: –ö–ª–∏–µ–Ω—Ç—ã, –°–º–µ—Ç—ã, –ü–æ–¥—Ä—è–¥—á–∏–∫–∏, –ó–∞–¥–∞—á–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –∏–ª–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—é —Å–ª–µ–≤–∞.';
            } else if (lowerCommand.includes('–Ω–∞—Å—Ç—Ä–æ–π–∫')) {
                response = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –ø–æ–º–æ—â–Ω–∏–∫–∞: —è–∑—ã–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, –≥–æ–ª–æ—Å–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º. –ü–æ–∫–∞ —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.';
            } else {
                response = '–ü–æ–Ω—è–ª –≤–∞—à –∑–∞–ø—Ä–æ—Å, –Ω–æ –ø–æ–∫–∞ –Ω–µ –º–æ–≥—É –Ω–∞ –Ω–µ–≥–æ –æ—Ç–≤–µ—Ç–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö, –ø—Ä–æ–µ–∫—Ç–∞—Ö –∏–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ.';
            }
            
            sendMessage(response, 'assistant');
            
            // –ì–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–≤–µ—Ç (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
            if (document.getElementById('voiceResponse').checked) {
                speakText(response);
            }
        }, 500);
    }
    
    // –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏
    function speakText(text) {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ru-RU';
            utterance.rate = 0.9;
            speechSynthesis.speak(utterance);
        }
    }
    
    // –û—á–∏—Å—Ç–∫–∞ —á–∞—Ç–∞
    function clearChat() {
        chatMessages.innerHTML = `
            <div class="flex space-x-3">
                <div class="w-8 h-8 bg-primary/10 rounded-full flex items-center justify-center">
                    <i data-lucide="bot" class="h-4 w-4 text-primary"></i>
                </div>
                <div class="flex-1">
                    <div class="bg-muted rounded-lg p-3">
                        <p class="text-sm">
                            –ü—Ä–∏–≤–µ—Ç! –Ø –≤–∞—à –≥–æ–ª–æ—Å–æ–≤–æ–π –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫. –ú–æ–≥—É –ø–æ–º–æ—á—å —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º–∏, 
                            –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ CRM —Å–∏—Å—Ç–µ–º–µ. 
                            –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?
                        </p>
                    </div>
                    <p class="text-xs text-muted-foreground mt-1">–°–µ–π—á–∞—Å</p>
                </div>
            </div>
        `;
        lucide.createIcons();
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    init();
</script>
{% endblock %}